
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>3.10. 모형진단과 다항회귀 &#8212; 데이터 사이언스 스쿨 - 데이터 분석 편</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "datascienceschool/book_data_analysis");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "💬 comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.11. 과최적화와 정규화" href="03_11.html" />
    <link rel="prev" title="3.9. 레버리지와 아웃라이어" href="03_09.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">데이터 사이언스 스쿨 - 데이터 분석 편</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    데이터 사이언스 스쿨 - 데이터 분석 편
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ch01/01_00.html">
   1. 데이터 분석의 소개
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch01/01_01.html">
     1.1. 이 책에서 다루는 데이터 분석이란?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch01/01_02.html">
     1.2. 데이터 분석을 위한 도구의 소개
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch01/01_03.html">
     1.3. 예제 데이터
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ch02/02_00.html">
   2. 탐색적 데이터 분석 - 개별 데이터의 특징을 분석한다.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch02/02_01.html">
     2.1. 확률적 데이터
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch02/02_02.html">
     2.2. 시각적 확률분포추정
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch02/02_03.html">
     2.3. 확률분포모형을 사용한 확률분포추정
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch02/02_04.html">
     2.4. 베르누이분포와 이항분포
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch02/02_05.html">
     2.5. 카테고리분포와 다항분포
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch02/02_06.html">
     2.6. 정규분포, 로그정규분포, 스튜던트t분포
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch02/02_07.html">
     2.7. 최대가능도추정
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch02/02_08.html">
     2.8. 탐색적 데이터 분석
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="03_00.html">
   3. 회귀분석 - 수치형 데이터를 예측한다.
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="03_01.html">
     3.1. 상관관계
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_02.html">
     3.2. 회귀분석의 소개
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_03.html">
     3.3. 선형회귀분석을 위한 준비
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_04.html">
     3.4. 최소자승법
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_05.html">
     3.5. 가중치 검정
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_06.html">
     3.6. 모형성능
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_07.html">
     3.7. 모형 선택
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_08.html">
     3.8. 예측
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_09.html">
     3.9. 레버리지와 아웃라이어
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     3.10. 모형진단과 다항회귀
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_11.html">
     3.11. 과최적화와 정규화
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_12.html">
     3.12. 스케일링과 다중공선성
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_13.html">
     3.13. 범주형 독립변수
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ch04/04_00.html">
   4. 분류 - 범주형 데이터를 예측한다.
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ch05/05_00.html">
   5. 딥러닝을 사용한 회귀분석과 분류
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ch06/06_00.html">
   6. 시계열분석
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ch07/07_00.html">
   7. 비지도학습
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/datascienceschool/book_data_analysis/main?urlpath=tree/./ch03/03_10.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<a href="https://github.com/datascienceschool/book_data_analysis"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/ch03/03_10.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   3.10.1. 부분회귀
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   3.10.2. 잔차분석
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   3.10.3. 다항회귀
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>모형진단과 다항회귀</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   3.10.1. 부분회귀
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   3.10.2. 잔차분석
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   3.10.3. 다항회귀
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1><span class="section-number">3.10. </span>모형진단과 다항회귀<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h1>
<p>지금까지는 예측값이 직선형태로 나오는 선형(linear)회귀분석을 이용하여 종속변수를 예측하였다. 그러나 현실의 데이터는 이러한 선형회귀분석 모형을 따르지 않을 수도 있다. 이 절에서는 선형회귀분석에서 사용한 모형이나 가정이 적정한지 아닌지를 확인하고 그렇지 않은 이런 경우에 어떤 방식으로 모형을 수정해야하는지를 공부한다. 우리가 사용한 모형과 가정이 적정한지를 검토하는 작업을 <b>모형진단(model diagnosis)</b>이라고 한다.</p>
<section id="id2">
<h2><span class="section-number">3.10.1. </span>부분회귀<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h2>
<p>독립변수가 하나뿐인 경우에는 x축을 독립변수로, y축을 종속변수로 하는 스캐터플롯과 예측값 직선을 이용하여 회귀분석의 결과를 시각적으로 표시하여 독립변수와 종속변수의 관계 및 회귀 성능을 유추할 수 있었다. 하지만 독립변수가 두개 이상인 경우에 이러한 방식을 사용하면 다른 독립변수의 영향으로 예측값이 직선으로 나오지 않기 때문에 이러한 시각화 방식을 사용하기 어렵다.</p>
<p>보스턴 집값 데이터의 일부를 lstat과 rm 두가지 독립변수로 선형회귀분석한 결과를 이용하여 예를 들어보자.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>

<span class="n">boston</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get_rdataset</span><span class="p">(</span><span class="s2">&quot;Boston&quot;</span><span class="p">,</span> <span class="s2">&quot;MASS&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="s2">&quot;medv ~ scale(lstat) + scale(rm)&quot;</span><span class="p">,</span> <span class="n">boston</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                   medv   R-squared:                       0.799
Model:                            OLS   Adj. R-squared:                  0.795
Method:                 Least Squares   F-statistic:                     193.1
Date:                Sat, 06 Aug 2022   Prob (F-statistic):           1.52e-34
Time:                        16:05:07   Log-Likelihood:                -239.08
No. Observations:                 100   AIC:                             484.2
Df Residuals:                      97   BIC:                             492.0
Df Model:                           2                                         
Covariance Type:            nonrobust                                         
================================================================================
                   coef    std err          t      P&gt;|t|      [0.025      0.975]
--------------------------------------------------------------------------------
Intercept       22.3090      0.268     83.135      0.000      21.776      22.842
scale(lstat)    -2.1390      0.339     -6.319      0.000      -2.811      -1.467
scale(rm)        3.6891      0.339     10.898      0.000       3.017       4.361
==============================================================================
Omnibus:                        5.327   Durbin-Watson:                   1.248
Prob(Omnibus):                  0.070   Jarque-Bera (JB):                4.802
Skew:                           0.419   Prob(JB):                       0.0906
Kurtosis:                       3.670   Cond. No.                         2.03
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<p>예를 들어 x축을 첫번째 독립변수인 lstat으로, y축을 종속변수인 medv로 놓고 2차원 평면에 데이터(o)와 예측값(x)을 그리면 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">boston</span><span class="o">.</span><span class="n">lstat</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">boston</span><span class="o">.</span><span class="n">medv</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">fittedvalues</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;원 데이터&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;예측값&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;다중회귀분석 결과를 2차원에 표시한 경우&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_10_7_0.png" src="../_images/03_10_7_0.png" />
</div>
</div>
<p>statsmodels 패키지가 제공하는 <code class="docutils literal notranslate"><span class="pre">plot_fit</span></code> 함수를 사용하면 좀 더 쉽게 그릴 수 있다. 이 때는 각 데이터에 대한 개별 잔차의 표준편차를 바(bar)로 표시해 준다. 개별 잔차의 표준편차보다도 바깥에 있는 데이터는 아웃라이어일 가능성이 높다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">plot_fit</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;scale(lstat)&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_10_9_0.png" src="../_images/03_10_9_0.png" />
</div>
</div>
<p>이러한 경우에 사용할 수 있는 방법이 CCPR(component-plus-residual) 및 부분회귀(partial-regression) 시각화 방법이다.</p>
<p><b>CCPR(component-plus-residual)</b> 시각화는 2차원 평면에서 x축을 특정한 독립변수 하나, 예를 들어 <span class="math notranslate nohighlight">\(k\)</span>번째 독립변수인 <span class="math notranslate nohighlight">\(x_k\)</span> 값으로 놓고 y축은 다음 데이터를 이용한다.</p>
<ul class="simple">
<li><p>원 데이터의 y축 값으로는</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\hat{y}_k = w_k x_k + e
\]</div>
<p>를 사용한다. 여기에서 <span class="math notranslate nohighlight">\(e\)</span>는 전체 독립변수를 사용한 다중선형회귀분석 결과에서 나온 잔차다.</p>
<ul class="simple">
<li><p>예측 데이터의 y축 값으로는 선형회귀 예측값에서 <span class="math notranslate nohighlight">\(x_k\)</span>과 관련된 부분인</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\hat{y}_k = w_k x_k 
\]</div>
<p>만 사용한다. 이렇게 하면 다중선형회귀분석의 결과로 나온 가중치의 값(기울기)도 표시하고 그에 따른 오차도 표시된다.</p>
<p>statsmodels 패키지는 CCPR 시각화를 위한 <code class="docutils literal notranslate"><span class="pre">plot_ccpr</span></code> 함수를 제공한다. 사용법은 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">plot_ccpr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;scale(lstat)&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_10_11_0.png" src="../_images/03_10_11_0.png" />
</div>
</div>
<p>또다른 방법은 부분회귀 방법을 사용하는 것이다. <b>부분회귀(partial regression)</b>는 특정한 독립변수 <span class="math notranslate nohighlight">\(x_k\)</span>과 종속변수 <span class="math notranslate nohighlight">\(y\)</span>만의 관계만 분석하고 <span class="math notranslate nohighlight">\(x_k\)</span>를 제외한 다른 독립변수의 영향은 제거하는 방법이다. 부분회귀를 하려면 원리적으로 다음과 같이 3번의 회귀분석을 해야 한다.</p>
<ol class="simple">
<li><p>특정한 독립변수 <span class="math notranslate nohighlight">\(x_k\)</span>를 제외한 나머지 독립변수들로 종속변수 <span class="math notranslate nohighlight">\(y\)</span>를 선형회귀분석하여 잔차 <span class="math notranslate nohighlight">\(y_k^{\ast}\)</span>를 구한다.</p></li>
<li><p>특정한 독립변수 <span class="math notranslate nohighlight">\(x_k\)</span>를 제외한 나머지 독립변수들로 특정한 독립변수 <span class="math notranslate nohighlight">\(x_k\)</span>를 선형회귀분석하여 잔차 <span class="math notranslate nohighlight">\(x_k^{\ast}\)</span>를 구한다.</p></li>
<li><p>잔차 <span class="math notranslate nohighlight">\(x_k^{\ast}\)</span>를 독립변수로, 잔차 <span class="math notranslate nohighlight">\(y_k^{\ast}\)</span>를 종속변수로 하여 선형회귀분석한다.</p></li>
</ol>
<p>예를 들어 첫번째 독립변수인 <span class="math notranslate nohighlight">\(x_1\)</span>과 종속변수 <span class="math notranslate nohighlight">\(y\)</span>만의 관계만 구하고 싶은 경우, 1번 작업을 통해 <span class="math notranslate nohighlight">\(x_1\)</span>을 제외한 <span class="math notranslate nohighlight">\(x_2, x_3, \ldots, x_k\)</span>만 사용하여 선형회귀분석을 한다. 그러면 이 때 나오는 잔차 <span class="math notranslate nohighlight">\(y_k^{\ast}\)</span>는 독립변수 <span class="math notranslate nohighlight">\(x_2, x_3, \ldots, x_k\)</span>로는 도저히 예측할 수 없는 부분만 남는다. 그리고 2번 작업을 통해 <span class="math notranslate nohighlight">\(x_1\)</span> 정보 중 <span class="math notranslate nohighlight">\(x_2, x_3, \ldots, x_k\)</span>와 상관관계가 있는 값을 제거하여 순수한 <span class="math notranslate nohighlight">\(x_1\)</span> 정보만을 남긴다. 마지막으로 3번 작업을 통해 순수한 <span class="math notranslate nohighlight">\(x_1\)</span> 정보와 <span class="math notranslate nohighlight">\(x_2, x_3, \ldots, x_k\)</span>로 예측 불가능한 정보 사이의 관계를 구하는 것이다. 이러한 방식으로 부분회귀를 하면 3번 작업에서 나온 가중치 <span class="math notranslate nohighlight">\(\hat{w}_k\)</span>가 모든 독립변수를 사용하였을 때 나오는 가중치 <span class="math notranslate nohighlight">\(\hat{w}_k\)</span>와 일치함을 수학적으로 증명할 수 있다.</p>
<p>statsmodels 패키지는 부분회귀 시각화를 위한 <code class="docutils literal notranslate"><span class="pre">plot_partregress</span></code> 함수를 제공한다. 이 함수를 사용할 때는 다음과 같은 인수를 넣어야 한다.</p>
<ol class="simple">
<li><p>종속변수의 이름 문자열</p></li>
<li><p>분석하고자 하는 특정 독립변수의 이름 문자열</p></li>
<li><p>분석하고자 하는 특정 독립변수를 제외한 나머지 독립변수들의 이름 문자열 리스트</p></li>
<li><p>데이터프레임</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">obs_labels</span></code>: 각 데이터에 라벨을 그리는 경우 <code class="docutils literal notranslate"><span class="pre">True</span></code>, 아니면 <code class="docutils literal notranslate"><span class="pre">False</span></code></p></li>
</ol>
<p>함수를 실행하면 x축에는 잔차 <span class="math notranslate nohighlight">\(x_k^{\ast}\)</span>를, y축에는 잔차 <span class="math notranslate nohighlight">\(y_k^{\ast}\)</span>를 스케터플롯으로 그리고 가중치 <span class="math notranslate nohighlight">\(\hat{w}_k\)</span>를 사용한 선형회귀 결과를 직선으로 표시한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">plot_partregress</span><span class="p">(</span><span class="s2">&quot;medv&quot;</span><span class="p">,</span> <span class="s2">&quot;scale(lstat)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;scale(rm)&quot;</span><span class="p">],</span> <span class="n">boston</span><span class="p">,</span>
                             <span class="n">obs_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>eval_env: 1
</pre></div>
</div>
<img alt="../_images/03_10_13_1.png" src="../_images/03_10_13_1.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">plot_regress_exog</span></code> 함수를 이용하면 CCPR과 부분회귀 결과를 동시에 그릴 수 있다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">plot_regress_exog</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;scale(lstat)&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>eval_env: 1
</pre></div>
</div>
<img alt="../_images/03_10_15_1.png" src="../_images/03_10_15_1.png" />
</div>
</div>
<p>상단 왼쪽의 그림은 우리가 처음에 그렸던 <code class="docutils literal notranslate"><span class="pre">plot_fit</span></code> 함수의 결과다. 하단은 부분회귀와 CCPR 결과다.</p>
<p><code class="docutils literal notranslate"><span class="pre">plot_regress_exog</span></code> 함수가 출력한 그림 중 상단 오른쪽의 그림은 <b>잔차플롯(residual plot)</b>이라고 하여 독립변수와 그에 대응하는 잔차의 값을 그린 것이다.</p>
</section>
<section id="id3">
<h2><span class="section-number">3.10.2. </span>잔차분석<a class="headerlink" href="#id3" title="Permalink to this headline">#</a></h2>
<p>잔차를 분석하는 이유는 우리가 만든 선형회귀분석 모형이 정상적인 모형인지 아닌지를 검증하기 위한 것이다. 만약 우리가 사용한 모형과 데이터가 선형회귀분석에 사용되는 기본적인 확률론적 가정을 만족한다면 잔차는 평균이 0이고 분산이 고정된 정규분포를 따라야 한다.</p>
<p>회귀분석 결과 요약에서 하단에 있는 부분이 잔차의 정규분포에 대한 통계치 및 정규성 검정 결과다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Omnibus</span><span class="p">:</span>                        <span class="mf">5.327</span>   
<span class="n">Prob</span><span class="p">(</span><span class="n">Omnibus</span><span class="p">):</span>                  <span class="mf">0.070</span>   <span class="n">Jarque</span><span class="o">-</span><span class="n">Bera</span> <span class="p">(</span><span class="n">JB</span><span class="p">):</span>                <span class="mf">4.802</span>
<span class="n">Skew</span><span class="p">:</span>                           <span class="mf">0.419</span>   <span class="n">Prob</span><span class="p">(</span><span class="n">JB</span><span class="p">):</span>                       <span class="mf">0.0906</span>
<span class="n">Kurtosis</span><span class="p">:</span>                       <span class="mf">3.670</span>   
</pre></div>
</div>
<p>각 항목의 의미는 다음과 같다.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Skew</span></code> : 잔차분포의 왜도(skewness)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Kurtosis</span></code> : 잔차분포의 첨도(kurtosis)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Omnibus</span></code> : 옴니버스 정규성 검정의 통계치</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Prob(Omnibus)</span></code> : 옴니버스 정규성 검정의 유의확률</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Jarque-Bera</span> <span class="pre">(JB)</span></code> : 자끄베라 정규성 검정의 통계치</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Prob(JB)</span></code> : 자끄베라 정규성 검정의 유의확률</p></li>
</ul>
<p>우리가 사용한 예제에서는 정규성 검정결과가 다음과 같다.</p>
<ul class="simple">
<li><p>옴니버스 정규성 검정의 유의확률 = 7%</p></li>
<li><p>자끄베라 정규성 검정의 유의확률 = 9%</p></li>
</ul>
<p>만약 유의수준이 5%라면 유의확률이 이보다 크므로 정규성 검정을 통과한다. 즉 모형의 기본가정을 만족한다.</p>
<p>만약 잔차가 정규성을 만족하지 못하면 우리가 지금까지 사용한 가중치의 유의확률이나 신뢰구간 등의 분석결과에 오차가 있을 수 있다. 따라서 원칙적으로는 정규성 분포를 만족할 때까지 아웃라이어를 제거하거나 모형을 수정할 필요가 있다.</p>
<p>그러나 현실적으로 데이터의 개수가 충분한 경우(보통 15개 이상), 잔차의 비정규성이 분석결과에 큰 영향을 미치는 경우는 드물고 대부분의 문제에서는 비실용적일 정도로 복잡한 모형이 아닌 한 정규성 검정읕 통과하지 못하는 경우가 많다. 정규성 검정의 중요성에 대해서는 아직도 통계학자들 사이에서 논란이 되고 있는 부분이지만 이 책에서는 일단 이 부분을 크게 신경쓰지 않고 넘어가기로 한다.</p>
<p>선형회귀에서 실질적으로 정규성보다 더 중요한 잔차의 성질은 다음 성질이다.</p>
<div class="admonition- admonition">
<p class="admonition-title">잔차의 조건부 평균</p>
<p>선형회귀분석으로 나온 <span class="math notranslate nohighlight">\(N\)</span>개의 잔차 <span class="math notranslate nohighlight">\(e\)</span>의 기댓값은 독립변수와 상관없이 항상 0이다.</p>
<div class="math notranslate nohighlight">
\[
\text{E}\left[ e | x \right] = 0
\]</div>
</div>
<div class="admonition- admonition">
<p class="admonition-title">잔차의 조건부 분산</p>
<p>선형회귀분석으로 나온 <span class="math notranslate nohighlight">\(N\)</span>개의 잔차 <span class="math notranslate nohighlight">\(e\)</span>의 분산은 독립변수와 상관없이 항상 일정하다. 이를 등분산성(homoscedasticity)이라고 한다. 만약 이를 만족하지 않으면 이분산성(heteroscedasticity)이라고 한다.</p>
<div class="math notranslate nohighlight">
\[
\text{Var}\left[ e | x \right] = \text{상수}
\]</div>
</div>
<p>statsmodels 패키지에는 잔차의 조건부 평균이 0인지 검증하기 위한 통계정 검정 기능이 없다 따라서 독립변수와 잔차의 관계를 나타내는 잔차플롯을 그려 시각적으로 살펴볼 수 밖에 없다.
안타깝게도 statsmodels 패키지는 잔차플롯만 그리는 함수도 없다. 따라서 잔차플롯만 그리고 싶을 때는 저자가 만든 다음 코드를 사용한다. 이 잔차플롯에서 파란색 곡선은 독립변수의 변화에 따른 잔차의 평균값을 표시한 것이다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">resid_plot</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">exo_name</span><span class="p">):</span>
    <span class="n">id_x</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">exog_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">exo_name</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">exog</span><span class="p">[:,</span> <span class="n">id_x</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">resid</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">nonparametric</span><span class="o">.</span><span class="n">lowess</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">frac</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">l</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;잔차플롯: 독립변수=</span><span class="si">{</span><span class="n">exo_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">resid_plot</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;scale(lstat)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_10_21_0.png" src="../_images/03_10_21_0.png" />
</div>
</div>
<p>잔차 평균이 독립변수와 관계없이 0이 되려면 잔차플롯에서 푸른 곡선이 y=0 에 해당하는 평평한 직선이어야 한다. 그러나 독립변수와 잔차의 관계를 보면 독립변수 값이 너무 작거나 커지면 잔차의 값이 양의 방향으로 증가하는 것을 볼 수 있다. rm 독립변수에 대해 잔차플롯을 그려도 비슷한 현상이 발생한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resid_plot</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;scale(rm)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_10_23_0.png" src="../_images/03_10_23_0.png" />
</div>
</div>
<p>잔차의 조건부 분산 성질의 경우에는 statmodels 패키지에 이를 검증하기 위한 다음과 같은 함수가 있다.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">het_breuschpagan</span></code> : 이분산성에 대한 브레슈-페이건(Breusch-Pagan) 검정</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">het_white</span></code> : 이분산성에 대한 화이트(white) 검정</p></li>
</ul>
<p>이 검정들의 귀무가설은 등분산성이므로 유의확률이 큰 경우에는 등분산성이고 유의확률이 작으면 이분산성이다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.stats.diagnostic</span> <span class="kn">import</span> <span class="n">het_breuschpagan</span><span class="p">,</span> <span class="n">het_white</span>
</pre></div>
</div>
</div>
</div>
<p>이 함수들의 반환값은 다음과 같은 순서로 나오는 값의 튜플이다.</p>
<ol class="simple">
<li><p>라그랑주 승수검정 통계치</p></li>
<li><p>라그랑주 승수검정 유의확률</p></li>
<li><p>F검정 통계치</p></li>
<li><p>F검정 유의확률</p></li>
</ol>
<p>두번째와 4번째의 유의확률의 값이 크면 등분산성이다. 우리가 사용한 예제에서는 이분산성이 존재하는 것을 확인할 수 있다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">het_breuschpagan</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">exog</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(22.398766185277374,
 1.3682634380455558e-05,
 13.99900628615844,
 4.55646855722389e-06)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">het_white</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">exog</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(23.458466930318266,
 0.00027580773458726204,
 5.7618283904568415,
 0.00011057945959355164)
</pre></div>
</div>
</div>
</div>
<p>이분산성이 존재하는 경우 가중치의 유의확률이나 신뢰구간에 오차가 있을 수 있으므로 앞에서 말한바와 마찬가지로 아웃라이어를 제거하거나 모형을 수정하여 다시 검정을 실시할 필요가 있다.</p>
</section>
<section id="id4">
<h2><span class="section-number">3.10.3. </span>다항회귀<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h2>
<p>잔차분석을 했을 때 잔차가 원래 가져야할 성질을 만족하지 않는 이유는 우리가 사용한 회귀모형이 데이터에 맞지 않기 때문이다. 즉 데이터가 다음과 같은 선형관계를 따르지 않는다</p>
<div class="math notranslate nohighlight">
\[
y = w_0 + w_1 x_1 + w_2 x_2 + \cdots + w_K x_K + \varepsilon 
\]</div>
<p>따라서 선형모형을 확장한 비선형 모형을 사용해야한다. 그런데 일반적인 비선형모형을 사용하면 지금까지 우리가 공부한 선형회귀분석을 활용할 수 없기 때문에 다음과 같은 비선형모형을 사용하는 것이 좋다.</p>
<div class="math notranslate nohighlight">
\[
y = w_0 + w_1 f_1(x_1, x_2, \ldots, x_K) + w_2 f_2(x_1, x_2, \ldots, x_K) + \cdots + w_L f_L(x_1, x_2, \ldots, x_K) + \varepsilon 
\]</div>
<p>이 식에서 <span class="math notranslate nohighlight">\(f_l()\)</span>은 독립변수 <span class="math notranslate nohighlight">\(x_1, x_2, \ldots, x_K\)</span>를 입력으로 가지는 비선형함수들이다.</p>
<p>이 모형은 다음과 같이 표시할 수도 있다.</p>
<div class="math notranslate nohighlight">
\[
y = w_0 + w_1 x'_1 + w_2 x'_2 + \cdots + w_L x'_L + \varepsilon 
\]</div>
<p>즉 기존에 우리가 사용한 독립변수 <span class="math notranslate nohighlight">\(x_1, x_2, \ldots, x_K\)</span>를 비선형 변환한 값을 새로운 독립변수 <span class="math notranslate nohighlight">\(x'_1, x'_2, \ldots, x'_L\)</span>로 사용하는 것이다. 이 때 비선형함수는 자유롭게 지정할 수 있기 때문에 새로운 독립변수의 개수 <span class="math notranslate nohighlight">\(L\)</span>는 기존의 독립변수의 개수 <span class="math notranslate nohighlight">\(K\)</span>보다 훨씬 많아질 수 있다.</p>
<p>이 방식을 사용하면 실질적으로는 비선형 함수를 사용하면서 우리가 지금까지 공부한 선형회귀분석을 활용할 수 있다.</p>
<p>이 때 비선형함수 <span class="math notranslate nohighlight">\(f_l()\)</span>를 만드는 방법은 데이터 분석가의 마음대로지만 가장 간단한 방법은 개별독립변수의 고차항 <span class="math notranslate nohighlight">\(x^2, x^3, x^4, \ldots\)</span>를 사용하는 방법이다. 예를 들어 독립변수가 하나뿐인 경우 회귀모형은 다음과 같아진다.</p>
<div class="math notranslate nohighlight">
\[
y = w_0 + w_1 x + w_2 x^2 +  + w_3 x^3 \cdots + w_L x^L + \varepsilon 
\]</div>
<p>이 방법을 <b>다항회귀(polynomial regression)</b>이라고 한다.</p>
<p>statsmodels 패키지에서 다항회귀를 하려면 모형 문자열에 거듭제곱을 나타내는 <code class="docutils literal notranslate"><span class="pre">**</span></code> 연산과 <code class="docutils literal notranslate"><span class="pre">I()</span></code> 연산을 사용하여 독립변수를 추가한다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="s2">&quot;y ~ x + I(x**2) + I(x**3) + I(x**4) + I(x**5)&quot;</span>
</pre></div>
</div>
<p>만약 <code class="docutils literal notranslate"><span class="pre">I()</span></code> 연산을 하지 않으면 나중에 설명할 상호작용(interaction) 항이 추가되어 다른 모형이 되므로 주의해야 한다.</p>
<p>예제로 사용한 보스턴 집값 분석에서 rm과 lstat의 2차항을 추가하여 분석하면 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula2</span> <span class="o">=</span> <span class="s2">&quot;medv ~ scale(lstat) + scale(rm) + scale(I(lstat**2)) + scale(I(rm**2))&quot;</span>
<span class="n">model2</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="n">formula2</span><span class="p">,</span> <span class="n">boston</span><span class="p">)</span>
<span class="n">result2</span> <span class="o">=</span> <span class="n">model2</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result2</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                   medv   R-squared:                       0.853
Model:                            OLS   Adj. R-squared:                  0.847
Method:                 Least Squares   F-statistic:                     137.8
Date:                Sat, 06 Aug 2022   Prob (F-statistic):           1.15e-38
Time:                        16:05:09   Log-Likelihood:                -223.48
No. Observations:                 100   AIC:                             457.0
Df Residuals:                      95   BIC:                             470.0
Df Model:                           4                                         
Covariance Type:            nonrobust                                         
========================================================================================
                           coef    std err          t      P&gt;|t|      [0.025      0.975]
----------------------------------------------------------------------------------------
Intercept               22.3090      0.232     96.161      0.000      21.848      22.770
scale(lstat)            -6.1843      0.998     -6.195      0.000      -8.166      -4.203
scale(rm)              -14.1352      4.350     -3.250      0.002     -22.770      -5.500
scale(I(lstat ** 2))     3.4907      0.915      3.813      0.000       1.673       5.308
scale(I(rm ** 2))       17.0996      4.304      3.973      0.000       8.555      25.645
==============================================================================
Omnibus:                       25.903   Durbin-Watson:                   1.424
Prob(Omnibus):                  0.000   Jarque-Bera (JB):               65.023
Skew:                           0.899   Prob(JB):                     7.59e-15
Kurtosis:                       6.517   Cond. No.                         46.2
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<p>일단 가중치의 유의확률로 볼 때 모든 독립변수가 유의하고 결정계수 성능은 증가한 것을 알 수 있다.</p>
<p>잔차플롯을 그려보면 잔차의 평균이 앞의 모형보다 0에 더 가까운 형태로 개선되었다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resid_plot</span><span class="p">(</span><span class="n">result2</span><span class="p">,</span> <span class="s2">&quot;scale(lstat)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_10_34_0.png" src="../_images/03_10_34_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resid_plot</span><span class="p">(</span><span class="n">result2</span><span class="p">,</span> <span class="s2">&quot;scale(rm)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_10_35_0.png" src="../_images/03_10_35_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resid_plot</span><span class="p">(</span><span class="n">result2</span><span class="p">,</span> <span class="s2">&quot;scale(I(lstat ** 2))&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_10_36_0.png" src="../_images/03_10_36_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resid_plot</span><span class="p">(</span><span class="n">result2</span><span class="p">,</span> <span class="s2">&quot;scale(I(rm ** 2))&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_10_37_0.png" src="../_images/03_10_37_0.png" />
</div>
</div>
<p>이분산성 검정을 한 결과도 유의확률이 1% 이상으로 증가하여 유의수준이 1%이면 검정을 통과하여 등분산성을 보이게 된다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">het_breuschpagan</span><span class="p">(</span><span class="n">result2</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">model2</span><span class="o">.</span><span class="n">exog</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(10.32306667382783,
 0.0353234696975647,
 2.7339564859078136,
 0.03337658699888184)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">het_white</span><span class="p">(</span><span class="n">result2</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">model2</span><span class="o">.</span><span class="n">exog</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(13.899283201672985,
 0.30718609379310136,
 1.1703712461321483,
 0.3170099161339497)
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./ch03"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="03_09.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">3.9. </span>레버리지와 아웃라이어</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="03_11.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">3.11. </span>과최적화와 정규화</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By 김도형<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>