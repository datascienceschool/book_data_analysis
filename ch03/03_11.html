
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>3.11. 과최적화와 정규화 &#8212; 데이터 사이언스 스쿨 - 데이터 분석 편</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "datascienceschool/book_data_analysis");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "💬 comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.12. 스케일링과 다중공선성" href="03_12.html" />
    <link rel="prev" title="3.10. 모형진단과 다항회귀" href="03_10.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">데이터 사이언스 스쿨 - 데이터 분석 편</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    데이터 사이언스 스쿨 - 데이터 분석 편
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ch01/01_00.html">
   1. 데이터 분석의 소개
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch01/01_01.html">
     1.1. 이 책에서 다루는 데이터 분석이란?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch01/01_02.html">
     1.2. 데이터 분석을 위한 도구의 소개
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch01/01_03.html">
     1.3. 예제 데이터
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ch02/02_00.html">
   2. 탐색적 데이터 분석 - 개별 데이터의 특징을 분석한다.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch02/02_01.html">
     2.1. 확률적 데이터
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch02/02_02.html">
     2.2. 시각적 확률분포추정
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch02/02_03.html">
     2.3. 확률분포모형을 사용한 확률분포추정
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch02/02_04.html">
     2.4. 베르누이분포와 이항분포
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch02/02_05.html">
     2.5. 카테고리분포와 다항분포
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch02/02_06.html">
     2.6. 정규분포, 로그정규분포, 스튜던트t분포
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch02/02_07.html">
     2.7. 최대가능도추정
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch02/02_08.html">
     2.8. 탐색적 데이터 분석
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="03_00.html">
   3. 회귀분석 - 수치형 데이터를 예측한다.
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="03_01.html">
     3.1. 상관관계
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_02.html">
     3.2. 회귀분석의 소개
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_03.html">
     3.3. 선형회귀분석을 위한 준비
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_04.html">
     3.4. 최소자승법
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_05.html">
     3.5. 가중치 검정
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_06.html">
     3.6. 모형성능
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_07.html">
     3.7. 모형 선택
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_08.html">
     3.8. 예측
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_09.html">
     3.9. 레버리지와 아웃라이어
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_10.html">
     3.10. 모형진단과 다항회귀
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     3.11. 과최적화와 정규화
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_12.html">
     3.12. 스케일링과 다중공선성
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_13.html">
     3.13. 범주형 독립변수
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ch04/04_00.html">
   4. 분류 - 범주형 데이터를 예측한다.
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ch05/05_00.html">
   5. 딥러닝을 사용한 회귀분석과 분류
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ch06/06_00.html">
   6. 시계열분석
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ch07/07_00.html">
   7. 비지도학습
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/datascienceschool/book_data_analysis/main?urlpath=tree/./ch03/03_11.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<a href="https://github.com/datascienceschool/book_data_analysis"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/ch03/03_11.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   3.11.1. 과최적화
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   3.11.2. 조정 성능 지표
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   3.11.3. 정규화
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>과최적화와 정규화</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   3.11.1. 과최적화
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   3.11.2. 조정 성능 지표
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   3.11.3. 정규화
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1><span class="section-number">3.11. </span>과최적화와 정규화<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h1>
<p>회귀분석을 하는 1차 목적은 종속변수와 독립변수의 관계를 알아내는 것이지만 2차 목적은 독립변수 데이터를 이용하여 종속변수를 예측하는 것이다. 그런데 이미 종속변수 값을 알고 있는 경우는 사실 예측을 할 필요가 없다. 종속변수 값 예측이 필요한 경우는 독립변수만 알고 있고 종속변수를 모르는 경우다. 보스턴 집값 데이터를 예로 들자면 보스턴에 새로운 지역이 생겨서 방의 평균 개수 등 독립변수 값은 알고 있지만 집값이라는 종속변수 값을 모를 때 이를 대강이라도 예측하기 위한 것이다. 따라서 이미 회귀분석에 사용된 데이터를 예측하는 것보다 중요한 것이 회귀분석에 사용되지 않은 데이터에 대해 예측을 잘 할 수 있어야 한다.</p>
<p>예측식을 구하기 위해 이미 회귀분석에 사용된 데이터를 <b>학습 데이터(traing data)</b>라 하고 이 데이터의 예측 성능을 <b>표본내(in-sample) 예측 성능</b> 또는 <b>학습성능</b>이라 한다. 올바른 예측 성능을 구하려면 회귀분석에 사용되지 않은 데이터에 대해서도 예측을 잘 할 수 있는지를 검증해야 한다. 회귀분석에 사용되지 않았지만 종속변수 값을 가지고 있어 예측 성능을 검증하는데 쓰일 수 있는 데이터를 <b>검증 데이터(test data)</b>라 하고 이를 이용한 예측 성능을 <b>표본외(out-of-sample) 예측 성능</b> 또는 <b>검증성능</b>이라고 한다. 예측이 회귀분석의 주된 목표라면 중요한 것은 표본내 예측 성능이 아니라 분석에 사용되지 않은 별개의 새로운 데이터를 넣었을 때 얼마나 예측을 잘 하는지를 알려주는 표본외 예측 성능이다. 표본외 성능을 계산할 때는 가지고 있는 데이터를 두 개로 나누어 하나를 학습 데이터로 사용한 회귀분석을 하고 나머지 데이터를 검증 데이터로 사용하여 표본외 성능을 알아보는 것이 일반적이다. 이러한 방법을 <b>교차검증(cross-validation)</b>이라고 한다.</p>
<p>이 때 학습 데이터를 이용한 표본내 성능을 높이기 위해 독립변수의 수를 너무 많이 늘리거나 너무 복잡한 비선형 모형을 사용하게 되면 표본내 성능은 높아지지만 표본외 성능이 하락하는 <b>과최적화(over-fitting)</b> 현상이 발생할 수 있다. 따라서 회귀분석을 할 때는 교차검증을 통해 과최적화가 발생하지 않도록 해야 한다.</p>
<p>이 절에서는 보스턴 집값 데이터를 사용하여 과최적화가 발생하는 현상을 살펴보고 이를 막기 위해 어떠한 조치를 취해야하는지를 설명한다.</p>
<section id="id2">
<h2><span class="section-number">3.11.1. </span>과최적화<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h2>
<p>우선 교차검증을 위해 보스턴 집값 데이터를 100개의 학습 데이터와 나머지 검증 데이터로 분리한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>

<span class="n">boston</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get_rdataset</span><span class="p">(</span><span class="s2">&quot;Boston&quot;</span><span class="p">,</span> <span class="s2">&quot;MASS&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
<span class="n">boston_train</span> <span class="o">=</span> <span class="n">boston</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span>
<span class="n">boston_test</span> <span class="o">=</span> <span class="n">boston</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">100</span><span class="p">:]</span>
</pre></div>
</div>
</div>
</div>
<p>lstat 값을 독립변수로 사용하는 간단한 회귀분석을 한 결과는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_name</span> <span class="o">=</span> <span class="s2">&quot;lstat&quot;</span>
<span class="n">formula</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;medv ~ scale(</span><span class="si">{</span><span class="n">x_name</span><span class="si">}</span><span class="s2">)&quot;</span>
<span class="n">result1</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">boston_train</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result1</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                   medv   R-squared:                       0.553
Model:                            OLS   Adj. R-squared:                  0.549
Method:                 Least Squares   F-statistic:                     121.4
Date:                Thu, 11 Aug 2022   Prob (F-statistic):           7.54e-19
Time:                        16:43:45   Log-Likelihood:                -279.06
No. Observations:                 100   AIC:                             562.1
Df Residuals:                      98   BIC:                             567.3
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
================================================================================
                   coef    std err          t      P&gt;|t|      [0.025      0.975]
--------------------------------------------------------------------------------
Intercept       22.3090      0.398     56.027      0.000      21.519      23.099
scale(lstat)    -4.3877      0.398    -11.019      0.000      -5.178      -3.597
==============================================================================
Omnibus:                       40.434   Durbin-Watson:                   1.087
Prob(Omnibus):                  0.000   Jarque-Bera (JB):               78.705
Skew:                           1.670   Prob(JB):                     8.12e-18
Kurtosis:                       5.781   Cond. No.                         1.00
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<p>이제 이 회귀분석의 표본내 성능을 늘리기 위해 앞 절에서 설명한 다항회귀를 실시한다. 다음은 다항회귀의 차수를 10차까지 늘리면서 회귀분석을 반복 실시하는 코드다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">result1</span><span class="p">}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">formula</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; + scale(I(</span><span class="si">{</span><span class="n">x_name</span><span class="si">}</span><span class="s2"> ** </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">))&quot;</span>
    <span class="n">result_i</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">boston_train</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">result_i</span>
</pre></div>
</div>
</div>
</div>
<p>이렇게 다항회귀의 차수를 늘렸을 때 표본내 성능을 결정계수 <span class="math notranslate nohighlight">\(R^2\)</span>와 잔차제곱합 RSS로 살펴보면 다음과 같이 차수를 늘림에 따라 결정계수가 계속 증가하고 잔차제곱합이 계속 감소하는 것을 알 수 있다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_rss</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span>
    <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">rsquared</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">ssr</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;차수&quot;</span><span class="p">,</span> <span class="s2">&quot;학습 결정계수&quot;</span><span class="p">,</span> <span class="s2">&quot;학습 잔차제곱합&quot;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;차수&quot;</span><span class="p">)</span>

<span class="n">df_rss</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">bar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_f62e2_row0_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 74.4%, transparent 74.4%);
}
#T_f62e2_row0_col1, #T_f62e2_row9_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 100.0%, transparent 100.0%);
}
#T_f62e2_row1_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 92.3%, transparent 92.3%);
}
#T_f62e2_row1_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 70.3%, transparent 70.3%);
}
#T_f62e2_row2_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 95.6%, transparent 95.6%);
}
#T_f62e2_row2_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 64.7%, transparent 64.7%);
}
#T_f62e2_row3_col0, #T_f62e2_row4_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 97.3%, transparent 97.3%);
}
#T_f62e2_row3_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 61.9%, transparent 61.9%);
}
#T_f62e2_row4_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 61.8%, transparent 61.8%);
}
#T_f62e2_row5_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 98.0%, transparent 98.0%);
}
#T_f62e2_row5_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 60.8%, transparent 60.8%);
}
#T_f62e2_row6_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 98.1%, transparent 98.1%);
}
#T_f62e2_row6_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 60.5%, transparent 60.5%);
}
#T_f62e2_row7_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 99.6%, transparent 99.6%);
}
#T_f62e2_row7_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 58.0%, transparent 58.0%);
}
#T_f62e2_row8_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 99.9%, transparent 99.9%);
}
#T_f62e2_row8_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 57.5%, transparent 57.5%);
}
#T_f62e2_row9_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 57.4%, transparent 57.4%);
}
</style>
<table id="T_f62e2">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_f62e2_level0_col0" class="col_heading level0 col0" >학습 결정계수</th>
      <th id="T_f62e2_level0_col1" class="col_heading level0 col1" >학습 잔차제곱합</th>
    </tr>
    <tr>
      <th class="index_name level0" >차수</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_f62e2_level0_row0" class="row_heading level0 row0" >1</th>
      <td id="T_f62e2_row0_col0" class="data row0 col0" >0.553373</td>
      <td id="T_f62e2_row0_col1" class="data row0 col1" >1553.790601</td>
    </tr>
    <tr>
      <th id="T_f62e2_level0_row1" class="row_heading level0 row1" >2</th>
      <td id="T_f62e2_row1_col0" class="data row1 col0" >0.686105</td>
      <td id="T_f62e2_row1_col1" class="data row1 col1" >1092.022691</td>
    </tr>
    <tr>
      <th id="T_f62e2_level0_row2" class="row_heading level0 row2" >3</th>
      <td id="T_f62e2_row2_col0" class="data row2 col0" >0.710969</td>
      <td id="T_f62e2_row2_col1" class="data row2 col1" >1005.522571</td>
    </tr>
    <tr>
      <th id="T_f62e2_level0_row3" class="row_heading level0 row3" >4</th>
      <td id="T_f62e2_row3_col0" class="data row3 col0" >0.723554</td>
      <td id="T_f62e2_row3_col1" class="data row3 col1" >961.739072</td>
    </tr>
    <tr>
      <th id="T_f62e2_level0_row4" class="row_heading level0 row4" >5</th>
      <td id="T_f62e2_row4_col0" class="data row4 col0" >0.723823</td>
      <td id="T_f62e2_row4_col1" class="data row4 col1" >960.802511</td>
    </tr>
    <tr>
      <th id="T_f62e2_level0_row5" class="row_heading level0 row5" >6</th>
      <td id="T_f62e2_row5_col0" class="data row5 col0" >0.728595</td>
      <td id="T_f62e2_row5_col1" class="data row5 col1" >944.200845</td>
    </tr>
    <tr>
      <th id="T_f62e2_level0_row6" class="row_heading level0 row6" >7</th>
      <td id="T_f62e2_row6_col0" class="data row6 col0" >0.729950</td>
      <td id="T_f62e2_row6_col1" class="data row6 col1" >939.488687</td>
    </tr>
    <tr>
      <th id="T_f62e2_level0_row7" class="row_heading level0 row7" >8</th>
      <td id="T_f62e2_row7_col0" class="data row7 col0" >0.740790</td>
      <td id="T_f62e2_row7_col1" class="data row7 col1" >901.775330</td>
    </tr>
    <tr>
      <th id="T_f62e2_level0_row8" class="row_heading level0 row8" >9</th>
      <td id="T_f62e2_row8_col0" class="data row8 col0" >0.743152</td>
      <td id="T_f62e2_row8_col1" class="data row8 col1" >893.559046</td>
    </tr>
    <tr>
      <th id="T_f62e2_level0_row9" class="row_heading level0 row9" >10</th>
      <td id="T_f62e2_row9_col0" class="data row9 col0" >0.743719</td>
      <td id="T_f62e2_row9_col1" class="data row9 col1" >891.586488</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>결정계수와 잔차제곱합이 변하는 모습은 다음 그림과 같다. 이 결과만 보면 마치 차수가 가장 높은 10차 다항회귀모형을 선택하는 것이 옳은 결정인 것 처럼 보인다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_rss</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;학습 결정계수&quot;</span><span class="p">,</span> <span class="s2">&quot;학습 잔차제곱합&quot;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_11_13_0.png" src="../_images/03_11_13_0.png" />
</div>
</div>
<p>다음은 과최적화가 발생하는지 살펴보기 위해 학습 데이터와 예측 결과를 시각화하여 표시한 것이다. 차수가 증가함에 따라 예측식의 모양이 복잡해지면서 학습에 사용된 데이터는 더 잘 예측하지만 학습에 사용되지 않은 lstat 값에 대해서는  상식적으로 나올 수 없는 값을 예측하는 것을 볼 수 있다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="k">def</span> <span class="nf">plot_train</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">subplot</span><span class="p">):</span>
    <span class="n">r_i</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">x_name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">35.9</span><span class="p">,</span> <span class="mi">100</span><span class="p">)})</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">r_i</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="o">*</span><span class="n">subplot</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">boston_train</span><span class="p">[</span><span class="n">x_name</span><span class="p">],</span> <span class="n">boston_train</span><span class="p">[</span><span class="s2">&quot;medv&quot;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">x_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">51</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;차수=</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span>
    <span class="n">plot_train</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;학습 데이터와 다중회귀 결과&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_11_15_0.png" src="../_images/03_11_15_0.png" />
</div>
</div>
<p>예를 들어 10차 다항회귀모형은 lstat 값이 34.5 일 때 집값을 -216.9 라고 예측한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result10</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
<span class="n">result10</span><span class="o">.</span><span class="n">get_prediction</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;lstat&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">34.5</span><span class="p">]}))</span><span class="o">.</span><span class="n">predicted_mean</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-216.93650211])
</pre></div>
</div>
</div>
</div>
<p>하지만 검증 데이터에서 lstat 값이 33~35 사이인 데이터를 찾아보면 실제로는 집값이 8.4 ~ 17.9 범위인 것을 알 수 있다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boston_test</span><span class="p">[(</span><span class="n">boston_test</span><span class="o">.</span><span class="n">lstat</span> <span class="o">&gt;</span> <span class="mi">34</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">boston_test</span><span class="o">.</span><span class="n">lstat</span> <span class="o">&lt;</span> <span class="mi">35</span><span class="p">)][[</span><span class="s2">&quot;lstat&quot;</span><span class="p">,</span> <span class="s2">&quot;medv&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lstat</th>
      <th>medv</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>141</th>
      <td>34.41</td>
      <td>14.4</td>
    </tr>
    <tr>
      <th>373</th>
      <td>34.77</td>
      <td>13.8</td>
    </tr>
    <tr>
      <th>412</th>
      <td>34.37</td>
      <td>17.9</td>
    </tr>
    <tr>
      <th>438</th>
      <td>34.02</td>
      <td>8.4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>다음은 학습에 사용하지 않은 검증 데이터와 예측식을 비교한 그림이다. 차수가 증가하면서 실제 집값과는 동떨어진 값을 예측하고 있음을 알 수 있다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_test</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">subplot</span><span class="p">):</span>
    <span class="n">r_i</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">x_name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">35.9</span><span class="p">,</span> <span class="mi">100</span><span class="p">)})</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">r_i</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="o">*</span><span class="n">subplot</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">boston_test</span><span class="p">[</span><span class="n">x_name</span><span class="p">],</span> <span class="n">boston_test</span><span class="p">[</span><span class="s2">&quot;medv&quot;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">x_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">51</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;차수=</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span>
    <span class="n">plot_test</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;검증 데이터와 다중회귀 결과&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_11_21_0.png" src="../_images/03_11_21_0.png" />
</div>
</div>
<p>검증 데이터에 대한 잔차제곱합을 구해보면 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rss_test</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">y_true</span> <span class="o">=</span> <span class="n">boston_test</span><span class="o">.</span><span class="n">medv</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get_prediction</span><span class="p">(</span><span class="n">boston_test</span><span class="p">)</span><span class="o">.</span><span class="n">predicted_mean</span>
    <span class="n">rss_test</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="n">df_rss</span><span class="p">[</span><span class="s2">&quot;검증 잔차제곱합&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rss_test</span>
<span class="n">df_rss</span><span class="p">[[</span><span class="s2">&quot;검증 잔차제곱합&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">bar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_11598_row0_col0, #T_11598_row4_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 0.3%, transparent 0.3%);
}
#T_11598_row1_col0, #T_11598_row2_col0, #T_11598_row3_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 0.2%, transparent 0.2%);
}
#T_11598_row5_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 0.4%, transparent 0.4%);
}
#T_11598_row6_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 0.7%, transparent 0.7%);
}
#T_11598_row7_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 66.8%, transparent 66.8%);
}
#T_11598_row8_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 0.6%, transparent 0.6%);
}
#T_11598_row9_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 100.0%, transparent 100.0%);
}
</style>
<table id="T_11598">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_11598_level0_col0" class="col_heading level0 col0" >검증 잔차제곱합</th>
    </tr>
    <tr>
      <th class="index_name level0" >차수</th>
      <th class="blank col0" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_11598_level0_row0" class="row_heading level0 row0" >1</th>
      <td id="T_11598_row0_col0" class="data row0 col0" >20145.399074</td>
    </tr>
    <tr>
      <th id="T_11598_level0_row1" class="row_heading level0 row1" >2</th>
      <td id="T_11598_row1_col0" class="data row1 col0" >17656.438628</td>
    </tr>
    <tr>
      <th id="T_11598_level0_row2" class="row_heading level0 row2" >3</th>
      <td id="T_11598_row2_col0" class="data row2 col0" >16362.769041</td>
    </tr>
    <tr>
      <th id="T_11598_level0_row3" class="row_heading level0 row3" >4</th>
      <td id="T_11598_row3_col0" class="data row3 col0" >18075.527274</td>
    </tr>
    <tr>
      <th id="T_11598_level0_row4" class="row_heading level0 row4" >5</th>
      <td id="T_11598_row4_col0" class="data row4 col0" >21171.613313</td>
    </tr>
    <tr>
      <th id="T_11598_level0_row5" class="row_heading level0 row5" >6</th>
      <td id="T_11598_row5_col0" class="data row5 col0" >32154.412838</td>
    </tr>
    <tr>
      <th id="T_11598_level0_row6" class="row_heading level0 row6" >7</th>
      <td id="T_11598_row6_col0" class="data row6 col0" >49392.894713</td>
    </tr>
    <tr>
      <th id="T_11598_level0_row7" class="row_heading level0 row7" >8</th>
      <td id="T_11598_row7_col0" class="data row7 col0" >5070235.057569</td>
    </tr>
    <tr>
      <th id="T_11598_level0_row8" class="row_heading level0 row8" >9</th>
      <td id="T_11598_row8_col0" class="data row8 col0" >44132.795197</td>
    </tr>
    <tr>
      <th id="T_11598_level0_row9" class="row_heading level0 row9" >10</th>
      <td id="T_11598_row9_col0" class="data row9 col0" >7588331.833684</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>차수가 3차까지 증가할 때는 잔차제곱합이 감소하지만 그 이후에는 오히려 잔차제곱합이 증가하여 예측 오차가 커지는 것을 알 수 있다. 이러한 현상을 과최적화라고 부른다. 과최적화를 막으려면 회귀분석을 할 때 표본내 성능을 사용하지 말고 표본외 성능을 이용해야 한다. 따라서 다항회귀의 차수는 가장 표본내 성능이 좋은 8차 모형이 아니라 가장 표본외 성능이 좋은  3차 모형을 사용해야 한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_rss</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;검증 잔차제곱합&quot;</span><span class="p">],</span> <span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">1.6e4</span><span class="p">,</span> <span class="mf">5e4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_11_25_0.png" src="../_images/03_11_25_0.png" />
</div>
</div>
</section>
<section id="id3">
<h2><span class="section-number">3.11.2. </span>조정 성능 지표<a class="headerlink" href="#id3" title="Permalink to this headline">#</a></h2>
<p>모형선택에 대한 절에서 설명하였듯이 선형회귀분석의 결정계수 값은 독립변수의 수가 증가할수록 항상 증가한다. 따라서 교차검증이 없이 학습 데이터를 사용한 결정계수만 고려하면 과최적화가 될 수 있다. 이를 피하기 위해 선형회귀분석에서는 다음과 같은 여러가지 대체 성능 지표를 제공한다. 이러한 대체 성능 지표는 모두 독립변수의 수가 증가하면 이에 따른 벌점(penalty)을 지표에 넣어 성능을 감소시킨다.</p>
<ul class="simple">
<li><p>조정결정계수 (Adjusted R-Squared, Adjusted coefficient of determination)</p></li>
<li><p>AIC (Akaike information criterion)</p></li>
<li><p>BIC (Bayesian information criterion)</p></li>
</ul>
<p>조정결정계수는 <span class="math notranslate nohighlight">\(R^2_{\text{adj}}\)</span> 로 표기하며 다음과 같이 정의한다.</p>
<div class="math notranslate nohighlight">
\[
R^2_{\text{adj}} = 1 - (1 - R^2)\dfrac{N-1}{N-K} = 1 - \dfrac{\text{RSS}/(N-K)}{\text{TSS} /(N-1)}
\]</div>
<p>조정결정계수 <span class="math notranslate nohighlight">\(R^2_{\text{adj}}\)</span>는 항상 결정계수 <span class="math notranslate nohighlight">\(R^2\)</span>보다 같거나 작으며 독립변수의 수 <span class="math notranslate nohighlight">\(K\)</span>가 증가할수록 그 차이가 커진다.</p>
<p>AIC(Akaike information criterion)와 BIC(Bayesian information criterion)는 로그가능도(log-likelihood) 값에 독립변수의 수로 인한 벌점을 추가한 것이며 각각 다음과 같이 정의한다.</p>
<div class="math notranslate nohighlight">
\[
\text{AIC} = N + N \log(2\pi) + N \log \left( \dfrac{RSS}{N} \right) + 2K
\]</div>
<div class="math notranslate nohighlight">
\[
\text{BIC} = N + N \log(2\pi) + N \log \left( \dfrac{RSS}{N} \right) + K\log N
\]</div>
<p>AIC나 BIC는 값이 작을수록 회귀성능이 좋다고 판단한다.</p>
<p>이 값들은 선형회귀분석 결과 요약의 상단 오른쪽에 나타나고 각각 회귀분석 결과 객체의 <code class="docutils literal notranslate"><span class="pre">rsquared_adj</span></code>, <code class="docutils literal notranslate"><span class="pre">aic</span></code>, <code class="docutils literal notranslate"><span class="pre">bic</span></code> 속성에 저장되어 있다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                            <span class="n">OLS</span> <span class="n">Regression</span> <span class="n">Results</span>                            
<span class="o">==============================================================================</span>
                                                                             
                                        <span class="n">Adj</span><span class="o">.</span> <span class="n">R</span><span class="o">-</span><span class="n">squared</span><span class="p">:</span>                  <span class="mf">0.549</span>
                                                                             
                                                                             
                                                                             
                                        <span class="n">AIC</span><span class="p">:</span>                             <span class="mf">562.1</span>
                                        <span class="n">BIC</span><span class="p">:</span>                             <span class="mf">567.3</span>
                                                                              
                                                                              
<span class="o">================================================================================</span>
</pre></div>
</div>
<p>앞에서 수행한 1차부터 8차까지의 다항회귀의 조정결정계수, AIC, BIC 값은 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_adj</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span>
    <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">rsquared_adj</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">aic</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">bic</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;차수&quot;</span><span class="p">,</span> <span class="s2">&quot;조정 결정계수&quot;</span><span class="p">,</span> <span class="s2">&quot;AIC&quot;</span><span class="p">,</span> <span class="s2">&quot;BIC&quot;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;차수&quot;</span><span class="p">)</span>
<span class="n">df_adj</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_62892_row0_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 61.1%, transparent 61.1%);
}
#T_62892_row0_col1, #T_62892_row0_col2, #T_62892_row7_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 80.0%, transparent 80.0%);
}
#T_62892_row1_col0, #T_62892_row1_col2 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 75.7%, transparent 75.7%);
}
#T_62892_row1_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 75.3%, transparent 75.3%);
}
#T_62892_row2_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 78.2%, transparent 78.2%);
}
#T_62892_row2_col1, #T_62892_row8_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 74.4%, transparent 74.4%);
}
#T_62892_row2_col2, #T_62892_row3_col2 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 75.2%, transparent 75.2%);
}
#T_62892_row3_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 79.3%, transparent 79.3%);
}
#T_62892_row3_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 74.0%, transparent 74.0%);
}
#T_62892_row4_col0, #T_62892_row6_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 79.0%, transparent 79.0%);
}
#T_62892_row4_col1, #T_62892_row5_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 74.3%, transparent 74.3%);
}
#T_62892_row4_col2 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 75.8%, transparent 75.8%);
}
#T_62892_row5_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 79.2%, transparent 79.2%);
}
#T_62892_row5_col2 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 76.2%, transparent 76.2%);
}
#T_62892_row6_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 74.5%, transparent 74.5%);
}
#T_62892_row6_col2 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 76.8%, transparent 76.8%);
}
#T_62892_row7_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 74.2%, transparent 74.2%);
}
#T_62892_row7_col2 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 76.9%, transparent 76.9%);
}
#T_62892_row8_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 79.9%, transparent 79.9%);
}
#T_62892_row8_col2 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 77.4%, transparent 77.4%);
}
#T_62892_row9_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 79.7%, transparent 79.7%);
}
#T_62892_row9_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 74.7%, transparent 74.7%);
}
#T_62892_row9_col2 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 78.0%, transparent 78.0%);
}
</style>
<table id="T_62892">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_62892_level0_col0" class="col_heading level0 col0" >조정 결정계수</th>
      <th id="T_62892_level0_col1" class="col_heading level0 col1" >AIC</th>
      <th id="T_62892_level0_col2" class="col_heading level0 col2" >BIC</th>
    </tr>
    <tr>
      <th class="index_name level0" >차수</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_62892_level0_row0" class="row_heading level0 row0" >1</th>
      <td id="T_62892_row0_col0" class="data row0 col0" >0.548815</td>
      <td id="T_62892_row0_col1" class="data row0 col1" >562.115965</td>
      <td id="T_62892_row0_col2" class="data row0 col2" >567.326306</td>
    </tr>
    <tr>
      <th id="T_62892_level0_row1" class="row_heading level0 row1" >2</th>
      <td id="T_62892_row1_col0" class="data row1 col0" >0.679633</td>
      <td id="T_62892_row1_col1" class="data row1 col1" >528.849382</td>
      <td id="T_62892_row1_col2" class="data row1 col2" >536.664892</td>
    </tr>
    <tr>
      <th id="T_62892_level0_row2" class="row_heading level0 row2" >3</th>
      <td id="T_62892_row2_col0" class="data row2 col0" >0.701937</td>
      <td id="T_62892_row2_col1" class="data row2 col1" >522.596954</td>
      <td id="T_62892_row2_col2" class="data row2 col2" >533.017634</td>
    </tr>
    <tr>
      <th id="T_62892_level0_row3" class="row_heading level0 row3" >4</th>
      <td id="T_62892_row3_col0" class="data row3 col0" >0.711914</td>
      <td id="T_62892_row3_col1" class="data row3 col1" >520.145006</td>
      <td id="T_62892_row3_col2" class="data row3 col2" >533.170857</td>
    </tr>
    <tr>
      <th id="T_62892_level0_row4" class="row_heading level0 row4" >5</th>
      <td id="T_62892_row4_col0" class="data row4 col0" >0.709133</td>
      <td id="T_62892_row4_col1" class="data row4 col1" >522.047577</td>
      <td id="T_62892_row4_col2" class="data row4 col2" >537.678598</td>
    </tr>
    <tr>
      <th id="T_62892_level0_row5" class="row_heading level0 row5" >6</th>
      <td id="T_62892_row5_col0" class="data row5 col0" >0.711085</td>
      <td id="T_62892_row5_col1" class="data row5 col1" >522.304578</td>
      <td id="T_62892_row5_col2" class="data row5 col2" >540.540770</td>
    </tr>
    <tr>
      <th id="T_62892_level0_row6" class="row_heading level0 row6" >7</th>
      <td id="T_62892_row6_col0" class="data row6 col0" >0.709403</td>
      <td id="T_62892_row6_col1" class="data row6 col1" >523.804266</td>
      <td id="T_62892_row6_col2" class="data row6 col2" >544.645627</td>
    </tr>
    <tr>
      <th id="T_62892_level0_row7" class="row_heading level0 row7" >8</th>
      <td id="T_62892_row7_col0" class="data row7 col0" >0.718003</td>
      <td id="T_62892_row7_col1" class="data row7 col1" >521.707229</td>
      <td id="T_62892_row7_col2" class="data row7 col2" >545.153761</td>
    </tr>
    <tr>
      <th id="T_62892_level0_row8" class="row_heading level0 row8" >9</th>
      <td id="T_62892_row8_col0" class="data row8 col0" >0.717467</td>
      <td id="T_62892_row8_col1" class="data row8 col1" >522.791930</td>
      <td id="T_62892_row8_col2" class="data row8 col2" >548.843632</td>
    </tr>
    <tr>
      <th id="T_62892_level0_row9" class="row_heading level0 row9" >10</th>
      <td id="T_62892_row9_col0" class="data row9 col0" >0.714923</td>
      <td id="T_62892_row9_col1" class="data row9 col1" >524.570933</td>
      <td id="T_62892_row9_col2" class="data row9 col2" >553.227805</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>그래프로 나타내면 3차 혹은 4차 다항회귀에서 가장 좋은 값을 가지는 것을 알 수 있다. 이는 위에서 수행한 교차검증의 결과와 유사하다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_adj</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_11_30_0.png" src="../_images/03_11_30_0.png" />
</div>
</div>
</section>
<section id="id4">
<h2><span class="section-number">3.11.3. </span>정규화<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h2>
<p>교차검증이 과최적화가 발생하는가를 알아내는 방법이라면 정규화(regularization)는 과최적화가 원천적으로 발생하지 못하게 하는 방법이다. 과최적화가 발생할 때는 선형회귀분석의 가중치의 크기가 비정상적으로 커지는 현상이 같이 발생한다. 정규화는 선형회귀분석 가중치의 크기가 너무 커지지 않도록 제어하여 과최적화가 발생하는 것을 막는다.</p>
<p>앞에서 수행한 다중회귀 결과에서 차수가 증가하면 가중치의 크기가 실제로 어떻게 변화하는지 살펴보자.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">w1</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;scale(lstat)&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">w2</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;scale(I(lstat ** 2))&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">w3</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;scale(I(lstat ** 3))&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">}</span>
<span class="n">w4</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;scale(I(lstat ** 4))&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">df_w</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;$|w_1|$&quot;</span><span class="p">:</span> <span class="n">w1</span><span class="p">,</span> <span class="s2">&quot;$|w_2|$&quot;</span><span class="p">:</span> <span class="n">w2</span><span class="p">,</span> <span class="s2">&quot;$|w_3|$&quot;</span><span class="p">:</span> <span class="n">w3</span><span class="p">,</span> <span class="s2">&quot;$|w_4|$&quot;</span><span class="p">:</span> <span class="n">w4</span><span class="p">})</span>
<span class="n">df_w</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;차수&quot;</span>
<span class="n">df_w</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">bar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_3a800_row0_col0, #T_3a800_row5_col0, #T_3a800_row5_col3 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 0.7%, transparent 0.7%);
}
#T_3a800_row0_col1, #T_3a800_row0_col2, #T_3a800_row0_col3, #T_3a800_row1_col2, #T_3a800_row1_col3, #T_3a800_row2_col3 {
  width: 10em;
}
#T_3a800_row1_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 1.9%, transparent 1.9%);
}
#T_3a800_row1_col1, #T_3a800_row4_col2 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 0.1%, transparent 0.1%);
}
#T_3a800_row2_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 3.4%, transparent 3.4%);
}
#T_3a800_row2_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 0.4%, transparent 0.4%);
}
#T_3a800_row2_col2, #T_3a800_row3_col3, #T_3a800_row4_col3 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 0.0%, transparent 0.0%);
}
#T_3a800_row3_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 6.1%, transparent 6.1%);
}
#T_3a800_row3_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 1.2%, transparent 1.2%);
}
#T_3a800_row3_col2 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 0.2%, transparent 0.2%);
}
#T_3a800_row4_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 5.4%, transparent 5.4%);
}
#T_3a800_row4_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 0.8%, transparent 0.8%);
}
#T_3a800_row5_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 2.6%, transparent 2.6%);
}
#T_3a800_row5_col2 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 1.6%, transparent 1.6%);
}
#T_3a800_row6_col0, #T_3a800_row6_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 7.2%, transparent 7.2%);
}
#T_3a800_row6_col2 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 4.8%, transparent 4.8%);
}
#T_3a800_row6_col3 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 2.7%, transparent 2.7%);
}
#T_3a800_row7_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 41.6%, transparent 41.6%);
}
#T_3a800_row7_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 37.0%, transparent 37.0%);
}
#T_3a800_row7_col2 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 30.1%, transparent 30.1%);
}
#T_3a800_row7_col3 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 22.9%, transparent 22.9%);
}
#T_3a800_row8_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 70.2%, transparent 70.2%);
}
#T_3a800_row8_col1 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 65.7%, transparent 65.7%);
}
#T_3a800_row8_col2 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 59.2%, transparent 59.2%);
}
#T_3a800_row8_col3 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 51.5%, transparent 51.5%);
}
#T_3a800_row9_col0, #T_3a800_row9_col1, #T_3a800_row9_col2, #T_3a800_row9_col3 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 100.0%, transparent 100.0%);
}
</style>
<table id="T_3a800">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_3a800_level0_col0" class="col_heading level0 col0" >$|w_1|$</th>
      <th id="T_3a800_level0_col1" class="col_heading level0 col1" >$|w_2|$</th>
      <th id="T_3a800_level0_col2" class="col_heading level0 col2" >$|w_3|$</th>
      <th id="T_3a800_level0_col3" class="col_heading level0 col3" >$|w_4|$</th>
    </tr>
    <tr>
      <th class="index_name level0" >차수</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
      <th class="blank col3" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_3a800_level0_row0" class="row_heading level0 row0" >1</th>
      <td id="T_3a800_row0_col0" class="data row0 col0" >4.387655</td>
      <td id="T_3a800_row0_col1" class="data row0 col1" >nan</td>
      <td id="T_3a800_row0_col2" class="data row0 col2" >nan</td>
      <td id="T_3a800_row0_col3" class="data row0 col3" >nan</td>
    </tr>
    <tr>
      <th id="T_3a800_level0_row1" class="row_heading level0 row1" >2</th>
      <td id="T_3a800_row1_col0" class="data row1 col0" >11.705900</td>
      <td id="T_3a800_row1_col1" class="data row1 col1" >7.627214</td>
      <td id="T_3a800_row1_col2" class="data row1 col2" >nan</td>
      <td id="T_3a800_row1_col3" class="data row1 col3" >nan</td>
    </tr>
    <tr>
      <th id="T_3a800_level0_row2" class="row_heading level0 row2" >3</th>
      <td id="T_3a800_row2_col0" class="data row2 col0" >20.997876</td>
      <td id="T_3a800_row2_col1" class="data row2 col1" >28.532474</td>
      <td id="T_3a800_row2_col2" class="data row2 col2" >12.307360</td>
      <td id="T_3a800_row2_col3" class="data row2 col3" >nan</td>
    </tr>
    <tr>
      <th id="T_3a800_level0_row3" class="row_heading level0 row3" >4</th>
      <td id="T_3a800_row3_col0" class="data row3 col0" >37.561319</td>
      <td id="T_3a800_row3_col1" class="data row3 col1" >91.331808</td>
      <td id="T_3a800_row3_col2" class="data row3 col2" >97.520636</td>
      <td id="T_3a800_row3_col3" class="data row3 col3" >39.073867</td>
    </tr>
    <tr>
      <th id="T_3a800_level0_row4" class="row_heading level0 row4" >5</th>
      <td id="T_3a800_row4_col0" class="data row4 col0" >32.970048</td>
      <td id="T_3a800_row4_col1" class="data row4 col1" >66.299925</td>
      <td id="T_3a800_row4_col2" class="data row4 col2" >41.693689</td>
      <td id="T_3a800_row4_col3" class="data row4 col3" >17.936717</td>
    </tr>
    <tr>
      <th id="T_3a800_level0_row5" class="row_heading level0 row5" >6</th>
      <td id="T_3a800_row5_col0" class="data row5 col0" >4.345815</td>
      <td id="T_3a800_row5_col1" class="data row5 col1" >201.367311</td>
      <td id="T_3a800_row5_col2" class="data row5 col2" >796.591643</td>
      <td id="T_3a800_row5_col3" class="data row5 col3" >1371.376515</td>
    </tr>
    <tr>
      <th id="T_3a800_level0_row6" class="row_heading level0 row6" >7</th>
      <td id="T_3a800_row6_col0" class="data row6 col0" >44.293542</td>
      <td id="T_3a800_row6_col1" class="data row6 col1" >571.215627</td>
      <td id="T_3a800_row6_col2" class="data row6 col2" >2357.648675</td>
      <td id="T_3a800_row6_col3" class="data row6 col3" >4999.339874</td>
    </tr>
    <tr>
      <th id="T_3a800_level0_row7" class="row_heading level0 row7" >8</th>
      <td id="T_3a800_row7_col0" class="data row7 col0" >254.915344</td>
      <td id="T_3a800_row7_col1" class="data row7 col1" >2918.838627</td>
      <td id="T_3a800_row7_col2" class="data row7 col2" >14723.819307</td>
      <td id="T_3a800_row7_col3" class="data row7 col3" >42626.314789</td>
    </tr>
    <tr>
      <th id="T_3a800_level0_row8" class="row_heading level0 row8" >9</th>
      <td id="T_3a800_row8_col0" class="data row8 col0" >430.317573</td>
      <td id="T_3a800_row8_col1" class="data row8 col1" >5183.139521</td>
      <td id="T_3a800_row8_col2" class="data row8 col2" >28939.241190</td>
      <td id="T_3a800_row8_col3" class="data row8 col3" >95943.395693</td>
    </tr>
    <tr>
      <th id="T_3a800_level0_row9" class="row_heading level0 row9" >10</th>
      <td id="T_3a800_row9_col0" class="data row9 col0" >612.624917</td>
      <td id="T_3a800_row9_col1" class="data row9 col1" >7886.670536</td>
      <td id="T_3a800_row9_col2" class="data row9 col2" >48895.898580</td>
      <td id="T_3a800_row9_col3" class="data row9 col3" >186169.033124</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>다항회귀 차수가 증가하면 가중치의 크기도 기하급수적으로 증가하는 것을 알 수 있다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_w</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;다항회귀에서 차수의 증가에 따른 가중치 크기의 변화&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_11_35_0.png" src="../_images/03_11_35_0.png" />
</div>
</div>
<p>정규화는 앞서 말한바와 같이 선형회귀분석 가중치의 크기가 너무 커지지 않도록 제어하여 과최적화가 발생하는 것을 막는 방법이다. 일반 선형회귀분석에서는 가중치를 구할 때 잔차제곱합 RSS를 최소화하는 가중치 벡터 <span class="math notranslate nohighlight">\(w\)</span>를 구했다.</p>
<div class="math notranslate nohighlight">
\[
w = \arg\min \Big( \text{RSS} \Big)
\]</div>
<p>하지만 정규화 선형회귀분석에서는 잔차제곱합 RSS에 가중치의 크기를 벌점(penality)으로 추가한 함수를 최소화한다.</p>
<div class="math notranslate nohighlight">
\[ 
w = \arg\min \left( \dfrac{\text{RSS}}{2N} + \underbrace{\alpha \left( (1-L_1) \cdot \dfrac{1}{2}\sum_{k=1}^{K} w_k^2 + L_1 \cdot \sum_{k=1}^{K} |w_k| \right)}_{\text{벌점(penalty)}} \right)
\]</div>
<p>가중치의 크기를 측정하는 방법으로는 제곱합을 이용하는 L2 방법과 절대값의 합을 이용하는 L1 방법이 있는데 위의 수식은 두가지 방법을 동시에 사용한 것이다. L2 벌점만 사용할 때는 <b>Ridge 회귀</b>, L1 벌점만 사용할 때는 <b>Lasso 회귀</b>라고 하며 두가지를 동시에 사용할 때는 <b>Elastic-Net 회귀</b>라고 한다.</p>
<p>전체적인 벌점의 비중은 <span class="math notranslate nohighlight">\(\alpha\)</span>라는 값으로 조절한다. <span class="math notranslate nohighlight">\(\alpha\)</span> 값을 크게 할수록 벌점이 커지므로 더 강력하게 정규화를 하는 것이다. L1 벌점과 L2 벌점의 상대적 비중은 <span class="math notranslate nohighlight">\(L_1\)</span>이라는 값으로 조절한다. L1=1 이면 L1 벌점만 사용하므로 Lasso 회귀가 되고 L1=0이면 L2 벌점만 사용하므로 Ridge 회귀가 된다. L1 값이 0과 1사이면 Elastic-Net 회귀다.</p>
<p>statsmodels 패키지에서 정규화 선형회귀를 하려면 모형 객체에서 <code class="docutils literal notranslate"><span class="pre">fit</span></code> 메서드가 아닌 <code class="docutils literal notranslate"><span class="pre">fit_regularized</span></code> 메서드를 호출한다. <code class="docutils literal notranslate"><span class="pre">fit_regularized</span></code> 메서드는 다음 두가지 인수를 가질 수 있다.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">alpha</span></code> : 벌점 비중 <span class="math notranslate nohighlight">\(\alpha\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">L1_wt</span></code> : L1 벌점 비중 <span class="math notranslate nohighlight">\(L_1\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;medv ~ scale(</span><span class="si">{</span><span class="n">x_name</span><span class="si">}</span><span class="s2">)&quot;</span>
<span class="n">result1_reg</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">boston_train</span><span class="p">)</span><span class="o">.</span><span class="n">fit_regularized</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">L1_wt</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>다만 <code class="docutils literal notranslate"><span class="pre">fit_regularized</span></code> 메서드로 나온 결과 객체는 일반 선형회귀분석 결과 객체처럼 다양한 기능이 없고 오로지 예측 기능을 위한 <code class="docutils literal notranslate"><span class="pre">predict</span></code> 메서드만 지원한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">x_name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">35.9</span><span class="p">,</span> <span class="mi">100</span><span class="p">)})</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">result1_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0     28.973204
1     28.709802
2     28.446400
3     28.182999
4     27.919597
        ...    
95     3.950038
96     3.686636
97     3.423234
98     3.159832
99     2.896431
Length: 100, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>정규화를 사용하여 1차부터 10차까지 다시 다항회귀를 한 결과는 다음과 같다. 일반 선형회귀와는 달리 차수를 증가시켜도 과최적화가 발생하지 않는 것을 볼 수 있다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_reg</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">result1_reg</span><span class="p">}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">formula</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; + scale(I(</span><span class="si">{</span><span class="n">x_name</span><span class="si">}</span><span class="s2"> ** </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">))&quot;</span>
    <span class="n">result_reg_i</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">boston_train</span><span class="p">)</span><span class="o">.</span><span class="n">fit_regularized</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">L1_wt</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">results_reg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">result_reg_i</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span>
    <span class="n">plot_train</span><span class="p">(</span><span class="n">results_reg</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;정규화 다중회귀 결과&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_11_41_0.png" src="../_images/03_11_41_0.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./ch03"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="03_10.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">3.10. </span>모형진단과 다항회귀</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="03_12.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">3.12. </span>스케일링과 다중공선성</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By 김도형<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>